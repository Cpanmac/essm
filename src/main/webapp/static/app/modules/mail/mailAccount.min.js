var $mailAccount_datagrid;var $mailAccount_form;var $mailAccount_dialog;var refreshDatagrid=false;$(function(){$mailAccount_datagrid=$("#mailAccount_datagrid").datagrid({url:ctxAdmin+"/mail/mailAccount/mailAccountDatagrid",fit:true,rownumbers:true,fitColumns:false,striped:true,remoteSort:false,pagination:true,pagePosition:"bottom",pageSize:20,pageList:[10,20,50,100,1000,99999],idField:"id",toolbar:[{text:"新增",iconCls:"easyui-icon-add",handler:function(){showDialog()}},"-",{text:"删除",iconCls:"easyui-icon-remove",handler:function(){del()}}],frozenColumns:[[{field:"ck",checkbox:true},{field:"name",title:"名称",width:120},{field:"mailAddress",title:"邮件地址",width:280}]],columns:[[{field:"id",title:"主键",hidden:true,sortable:true,align:"right",width:80},{field:"username",title:"邮箱账号",width:280},{field:"activateString",title:"邮箱活动",width:120},{field:"operate",title:"操作",hidden:true,formatter:function(b,a,c){return"&nbsp;<a class='easyui-linkbutton' data-options='iconCls:\"easyui-icon-ok\"' onclick='test(\""+a.id+"\")'>测试</a>&nbsp;<a class='easyui-linkbutton' data-options='iconCls:\"easyui-icon-edit\"' onclick='showDialog(\""+a.id+"\")'>编辑</a>&nbsp;<a class='easyui-linkbutton' data-options='iconCls:\"easyui-icon-remove\"' onclick='del(\""+a.id+"\")'>删除</a>&nbsp;"}}]],onRowContextMenu:function(b,c,a){b.preventDefault();$(this).datagrid("unselectAll");$(this).datagrid("selectRow",c)}}).datagrid("showColumn","operate")});function showDialog(a){var b=ctxAdmin+"/mail/mailAccount/input";if(a!=undefined){b=b+"?id="+a}$mailAccount_dialog=$("<div/>").dialog({title:"邮箱账号",top:20,height:450,width:600,modal:true,maximizable:true,href:b,buttons:[{text:"测试",iconCls:"easyui-icon-save",handler:function(){testformInit();$mailAccount_form.submit()}},{text:"保存",iconCls:"easyui-icon-save",handler:function(){formInit();$mailAccount_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$mailAccount_dialog.dialog("destroy")}}],onClose:function(){$(this).dialog("destroy")}})}function testformInit(){$mailAccount_form=$("#mailAccount_form ").form({url:ctxAdmin+"/mail/mailAccount/testForm",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"正在验证中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(c){$.messager.progress("close");var a=$.parseJSON(c);var b=a.code;if(b>0){var d=a.msg;$.messager.alert("测试结果",d);if(b==1){$("input[name='activate']").get(0).checked=true}else{$("input[name='activate']").get(1).checked=true}}else{eu.showAlertMsg(a.msg,"error")}}})}function formInit(){$mailAccount_form=$("#mailAccount_form ").form({url:ctxAdmin+"/mail/mailAccount/_save",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(b){$.messager.progress("close");var a=$.parseJSON(b);if(a.code==1){$mailAccount_datagrid.datagrid("reload");$mailAccount_dialog.dialog("destroy");eu.showMsg(a.msg)}else{eu.showAlertMsg(a.msg,"error")}}})}function test(a){$.ajax({url:ctxAdmin+"/mail/mailAccount/test?id="+a,type:"post",dataType:"json",traditional:true,success:function(b){$.messager.progress("close");if(b.code==1){$mailAccount_datagrid.datagrid("reload");eu.showMsg(b.msg)}else{eu.showAlertMsg(b.msg,"error")}}})}function del(b){var c=new Array();$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});if(b!=undefined){c.push(b)}else{var a=$mailAccount_datagrid.datagrid("getSelections");$.each(a,function(d,e){c.push(e.id)})}if(c.length<1){$.messager.progress("close");eu.showAlertMsg("无法执行该操作.");return}$.ajax({url:ctxAdmin+"/mail/mailAccount/remove",type:"post",data:{ids:c},dataType:"json",traditional:true,success:function(d){$.messager.progress("close");if(d.code==1){$mailAccount_datagrid.datagrid("reload");eu.showMsg(d.msg)}else{eu.showAlertMsg(d.msg,"error")}}})};